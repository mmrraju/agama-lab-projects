Flow agama.pw.reset
     Basepath ""
Log "@info Necessary library import"
authService = Call io.jans.as.server.service.AuthenticationService#class 
userService = Call io.jans.as.server.service.UserService#class 
userServiceCdiUtil = Call io.jans.service.cdi.util.CdiUtil#bean userService
identity = Call io.jans.as.server.security.Identity#class 
authServiceCdiUtil = Call io.jans.service.cdi.util.CdiUtil#bean authService
authResult = {}
userMail = {}
userPassword = {}
Repeat 3 times max
     creds = RRF "login.ftlh" authResult
     authResult.success = Call authServiceCdiUtil authenticate creds.username creds.password
     authResult.uid = creds.username
creds = RRF "pwreset.ftlh" userMail
userMail.success  = Call userServiceCdiUtil getUserByAttribute "mail" creds.email
When authResult.success  is true
     Log "@trace User found with user mail: " creds.email
     pw = RRF "resetpw.ftlh" userPassword
Log "@trace User not found for mail : '" creds.email