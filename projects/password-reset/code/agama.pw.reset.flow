Flow agama.pw.reset
     Basepath ""
Log "@info Necessary library import"
authService = Call io.jans.as.server.service.AuthenticationService#class 
userService = Call io.jans.as.server.service.UserService#class 
userServiceCdiUtil = Call io.jans.service.cdi.util.CdiUtil#bean userService
identity = Call io.jans.as.server.security.Identity#class 
authServiceCdiUtil = Call io.jans.service.cdi.util.CdiUtil#bean authService
authResult = {}
userMail = {}
userPassword = {}
tokenVariable = {}
Repeat 3 times max
     creds = RRF "login.ftlh" authResult
     authResult.success = Call authServiceCdiUtil authenticate creds.username creds.password
     authResult.uid = creds.username
creds = RRF "pwreset.ftlh" userMail
foundUser = Call userServiceCdiUtil getUserByAttribute "mail" creds.email
When foundUser is not null
     Log "@trace User found with user mail: " creds.email
     tokenStore = 12345
     userInputToken = RRF "otp.ftlh" tokenVariable
     Log "@info Check user input token and db stored token"
     When userInputToken.value is tokenStore
Log "@trace User not found for mail : '" creds.email