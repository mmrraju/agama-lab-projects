Flow agama.pw.reset
     Basepath ""
Log "@info Necessary library import"
authService = Call io.jans.as.server.service.AuthenticationService#class 
userService = Call io.jans.as.server.service.UserService#class 
userServiceCdiUtil = Call io.jans.service.cdi.util.CdiUtil#bean userService
identity = Call io.jans.as.server.security.Identity#class 
authServiceCdiUtil = Call io.jans.service.cdi.util.CdiUtil#bean authService
authResult = {}
userMail = {}
userPassword = {}
tokenVariable = {}
Repeat 3 times max
     creds = RRF "login.ftlh" authResult
     authResult.success = Call authServiceCdiUtil authenticate creds.username creds.password
     authResult.uid = creds.username
creds = RRF "pwreset.ftlh" userMail
foundUser = Call userServiceCdiUtil getUserByAttribute "mail" creds.email
When foundUser is not null
     Log "@trace User found with user mail: " creds.email
     dbToken = 12345
     Repeat 2 times max
          userInputToken = RRF "otp.ftlh" tokenVariable
          tokenVariable.value = userInputToken.first
          When tokenVariable.value is dbToken
               Repeat 2 times max
                    Log "@info Insert new password"
                    pw = RRF "resetpw.ftlh" userPassword
                    userPassword.value = pw.password
     Log "@info Otp doesn't matching"
Log "@trace User not found for mail : " creds.email