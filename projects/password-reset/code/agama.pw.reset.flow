Flow agama.pw.reset
     Basepath ""
Log "@info Necessary library import"
authService = Call io.jans.as.server.service.AuthenticationService#class 
userService = Call io.jans.as.server.service.UserService#class 
userServiceCdiUtil = Call io.jans.service.cdi.util.CdiUtil#bean userService
identity = Call io.jans.as.server.security.Identity#class 
authServiceCdiUtil = Call io.jans.service.cdi.util.CdiUtil#bean authService
authResult = {}
userMail = {}
Repeat 3 times max
     creds = RRF "login.ftlh" authResult
     authResult.success = Call authServiceCdiUtil authenticate creds.username creds.password
     authResult.uid = creds.username
creds = RRF "pwreset.ftlh" userMail
authResult.success  = Call authServiceCdiUtil authenticate creds.username
When authResult.success  is true
     Log "@trace User found with user id: " creds.username
Log "@trace User not found for uid : '" creds.username